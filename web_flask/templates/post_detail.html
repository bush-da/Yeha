<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }} - Yeha</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles.css') }}">
</head>
<body>
    <header>
        <div class="logo">
            <a href="{{ url_for('home.index') }}">Yeha</a>
        </div>
        <nav class="nav-links">
            <a href="{{ url_for('home.index') }}" class="active">Home</a>
            <a href="{{ url_for('about.about') }}">About</a>
            {% if session.get('user_id') %}
                <a href="{{ url_for('profile.profile', user_id=session['user_id']) }}" class="profile">Profile</a>
                <a href="{{ url_for('auth.logout') }}" class="logout">Logout</a>
            {% else %}
                <a href="{{ url_for('auth.login') }}" class="sign-in">Sign In</a>
            {% endif %}
        </nav>
    </header>

    <main>
        <section class="post-detail">
            <div class="post-header">
	      <a href="/profile/{{ post.author.id }}">
	      <img src="{{ url_for('static', filename='images/' + (post.author.profile_picture if post.author.profile_picture else 'user.png')) }}" alt="Author's profile picture" class="profile-pic">
                <div class="author-info">
                    <h3 class="author-name">{{ post.author.username }}</h3></a>
                    <p class="author-bio">{{ post.author.bio }}</p>
                    {% if session.get('user_id') and post.author_id != session['user_id'] %}
                    <form action="{{ url_for('follow.follow_user', user_id=post.author_id) }}" method="POST">
                        <button type="submit" class="follow-btn">Follow</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            <h2>{{ post.title }}</h2>
	    {% if session.get('user_id') and post.author_id == session['user_id'] %}
	    <a href="{{ url_for('post.update_post', post_id=post.id) }}" class="update-btn">Edit</a>
              <form action="{{ url_for('post.delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="delete-btn">Delete</button>
              </form>
	      {% endif %}
	    {% for content in post.contents %}
		    {% if content.file_url %}
		        <img src="{{ content.file_url }}" alt="Post image">
		    {% else %}
		<p>{{ content.content }}</p>
		    {% endif %}
		{% endfor %}

            <div class="post-actions">
                <form action="{{ url_for('like.like_post', post_id=post.id) }}" method="POST">
		  <p> likes: {{ count_likes }} </p>
                    <button type="submit" class="like-btn">
                        <img src="{{ url_for('static', filename='images/like.png') }}" alt="Like" class="action-icon">
                    </button>
                </form>
                <button class="comment-btn" onclick="toggleCommentBox()">
                    <img src="{{ url_for('static', filename='images/comment.png') }}" alt="Comment" class="action-icon">
                </button>
                <button class="share-btn">
                    <img src="{{ url_for('static', filename='images/share.png') }}" alt="Share" class="action-icon">
                </button>
            </div>
            <div class="comment-box" id="comment-box" style="display:none;">
                <form action="{{ url_for('comment.add_comment', post_id=post.id) }}" method="POST">
                    <textarea name="comment" rows="3" placeholder="Add a comment..."></textarea>
                    <button type="submit">Comment</button>
                </form>
            </div>

            <section class="comments">
                <h3>Comments</h3>
                {% for comment in comments %}
                <div class="comment">
                    <p><a href="/profile/{{ comment.author_id }}">{{ comment.author.username }}</a>: {{ comment.content }}</p>
                </div>
                {% endfor %}
            </section>
        </section>
    </main>

    <script>
        function toggleCommentBox() {
            var commentBox = document.getElementById('comment-box');
            commentBox.style.display = commentBox.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html>
